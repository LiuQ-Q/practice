<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
</head>
<body>
	
</body>
</html>

<script type="text/javascript">
	function jsonp(options) {
		options = options || {};
		if (!options.url) {
			throw new Error("参数url不能为空");
		}

		var myHead = document.getElementsByTagName('head')[0];
		// var params = options.data;
		var myScript = document.createElement('script');
		myHead.appendChild(myScript);
		//回调函数
    window[options.callback] = function(json) {
			myHead.removeChild(myScript);
			clearTimeout(myScript.timer);
			window[options.callback] = null;
			options.success && options.success(json);
		};
		// myScript.src = options.url + '?' + params;
		myScript.src = options.url;

    //超时处理
		if (options.time) {
			myScript.timer = setTimeout(function() {
				window[options.callback] = null;
				myHead.removeChild(myScript);
				options.fail && window[options.fail]({
					message: "请求超时"
				})
			},options.time);
		}
	};
	function getMessage(data) {
		console.log(data);
	}
	function getMessageFailed(err) {
		console.log(err);
	}
	
	//调用示例
	var item = {
		url: "http://suggestion.baidu.com/su?wd=12&cb=getMessage",
		// url: "http://baike.baidu.com/api/openapi/BaikeLemmaCardApi?scope=103&format=json&appid=379020&bk_key=123&bk_length=600&cb=getMessage",
		callback: 'getMessage',
		success: getMessage,
		fail: 'getMessageFailed',
		time: 5000,
	};
	jsonp(item);
</script>